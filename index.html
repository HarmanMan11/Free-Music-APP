<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Free Music App v1.1.0</title>
  <style>
    /* Reset –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121212;
      color: #eee;
      min-height: 100vh;
      padding-bottom: 4rem;
      transition: background-color 0.3s, color 0.3s;
      overflow-y: scroll;
    }
    body.light-theme {
      background-color: #fefefe;
      color: #222;
    }

    header {
      background-color: #1f1f1f;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    body.light-theme header {
      background-color: #eaeaea;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    h1 {
      margin: 0;
      color: #00ff88;
      user-select: none;
    }
    body.light-theme h1 {
      color: #008844;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.75rem;
      padding: 1rem;
      background-color: #1a1a1a;
      box-shadow: inset 0 -1px 3px rgba(0,0,0,0.7);
      user-select: none;
    }
    body.light-theme .controls {
      background-color: #f5f5f5;
      box-shadow: inset 0 -1px 3px rgba(0,0,0,0.1);
    }
    .controls input[type="text"] {
      flex-grow: 1;
      max-width: 300px;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
      outline: none;
      transition: background-color 0.3s, color 0.3s;
      background-color: #2b2b2b;
      color: #eee;
    }
    body.light-theme .controls input[type="text"] {
      background-color: #fff;
      color: #222;
      border: 1px solid #ccc;
    }
    .controls button {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      border: none;
      background-color: #00ff88;
      color: #121212;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,255,136,0.5);
      transition: background-color 0.3s, color 0.3s;
      user-select: none;
    }
    .controls button:hover {
      background-color: #00cc66;
      box-shadow: 0 4px 12px rgba(0,204,102,0.8);
      color: #fff;
    }
    body.light-theme .controls button {
      background-color: #008844;
      color: #fff;
      box-shadow: 0 3px 8px rgba(0,136,68,0.5);
    }
    body.light-theme .controls button:hover {
      background-color: #006622;
      box-shadow: 0 4px 12px rgba(0,102,34,0.8);
    }

    .track-list {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1rem 6rem;
      max-width: 800px;
      margin: 0 auto;
    }
    .track {
      background: #2e2e2e;
      padding: 1rem 1.2rem;
      border-radius: 12px;
      width: 100%;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      position: relative;
      transition: background-color 0.3s;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    body.light-theme .track {
      background: #fff;
      color: #222;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .track h3 {
      margin: 0;
      font-size: 1.15rem;
      user-select: text;
    }
    audio {
      width: 100%;
      outline: none;
      border-radius: 6px;
      background-color: #111;
    }
    body.light-theme audio {
      background-color: #ddd;
    }
    .like {
      position: absolute;
      top: 12px;
      right: 12px;
      font-size: 1.7rem;
      cursor: pointer;
      user-select: none;
      transition: color 0.3s;
      color: #bbb;
    }
    .like.liked {
      color: #ff4081;
      text-shadow: 0 0 5px #ff4081aa;
    }
    .like:hover {
      color: #ff4081;
    }

    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #1f1f1f;
      padding: 1rem;
      text-align: center;
      color: #888;
      font-size: 0.9rem;
      user-select: none;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.7);
      transition: background-color 0.3s, color 0.3s;
    }
    body.light-theme .footer {
      background: #eaeaea;
      color: #555;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    }

    /* –ß–∞—Ç: –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è */
    #chatToggleBtn {
      position: fixed;
      bottom: 80px;
      right: 24px;
      background-color: #00ff88;
      color: #121212;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(0,255,136,0.7);
      user-select: none;
      z-index: 9999;
      transition: background-color 0.3s, color 0.3s;
    }
    #chatToggleBtn:hover {
      background-color: #00cc66;
      color: #fff;
    }
    body.light-theme #chatToggleBtn {
      background-color: #008844;
      color: #fff;
      box-shadow: 0 4px 14px rgba(0,136,68,0.7);
    }
    body.light-theme #chatToggleBtn:hover {
      background-color: #006622;
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–∞ */
    #chatModal {
      position: fixed;
      bottom: 140px;
      right: 24px;
      width: 320px;
      max-height: 420px;
      background-color: #222;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.8);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 10000;
      user-select: none;
      color: #eee;
      transition: background-color 0.3s, color 0.3s;
    }
    body.light-theme #chatModal {
      background-color: #f0f0f0;
      color: #222;
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }
    #chatModal header {
      background-color: #00ff88;
      color: #121212;
      padding: 0.5rem 1rem;
      font-weight: 700;
      font-size: 1.1rem;
      user-select: none;
    }
    body.light-theme #chatModal header {
      background-color: #008844;
      color: #fff;
    }
    #chatMessages {
      flex-grow: 1;
      padding: 0.75rem 1rem;
      overflow-y: auto;
      font-size: 0.9rem;
      line-height: 1.3;
      background-color: #1a1a1a;
      user-select: text;
    }
    body.light-theme #chatMessages {
      background-color: #fff;
    }
    .chat-message {
      margin-bottom: 0.4rem;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      word-wrap: break-word;
      max-width: 80%;
    }
    .chat-message.me {
      background-color: #00ff88aa;
      color: #121212;
      margin-left: auto;
      text-align: right;
    }
    .chat-message.other {
      background-color: #333;
      color: #eee;
    }
    body.light-theme .chat-message.other {
      background-color: #ddd;
      color: #222;
    }
    #chatInputWrapper {
      padding: 0.5rem;
      background-color: #111;
      display: flex;
      gap: 0.5rem;
    }
    body.light-theme #chatInputWrapper {
      background-color: #ddd;
    }
    #chatInput {
      flex-grow: 1;
      border-radius: 6px;
      border: none;
      padding: 0.4rem 0.75rem;
      font-size: 1rem;
      outline: none;
      color: #eee;
      background-color: #333;
      transition: background-color 0.3s, color 0.3s;
    }
    body.light-theme #chatInput {
      color: #222;
      background-color: #fff;
      border: 1px solid #bbb;
    }
    #chatSendBtn {
      background-color: #00ff88;
      border: none;
      border-radius: 6px;
      color: #121212;
      font-weight: 700;
      font-size: 1.1rem;
      padding: 0 0.8rem;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
    }
    #chatSendBtn:hover {
      background-color: #00cc66;
      color: #fff;
    }
    body.light-theme #chatSendBtn {
      background-color: #008844;
      color: #fff;
    }
    body.light-theme #chatSendBtn:hover {
      background-color: #006622;
    }

    /* –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–∏–∫–∞ */
    #nicknameModal {
      position: fixed;
      inset: 0;
      background-color: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 11000;
      user-select: none;
    }
    #nicknameModalContent {
      background-color: #222;
      padding: 1.5rem 2rem;
      border-radius: 12px;
      width: 280px;
      color: #eee;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.9);
    }
    body.light-theme #nicknameModalContent {
      background-color: #fff;
      color: #222;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    #nicknameInput {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
      margin: 1rem 0;
      outline: none;
    }
    body.light-theme #nicknameInput {
      border: 1px solid #bbb;
    }
    #nicknameSubmitBtn {
      background-color: #00ff88;
      border: none;
      border-radius: 6px;
      color: #121212;
      font-weight: 700;
      padding: 0.5rem 1.2rem;
      cursor: pointer;
      user-select: none;
      font-size: 1rem;
      transition: background-color 0.3s;
    }
    #nicknameSubmitBtn:hover {
      background-color: #00cc66;
      color: #fff;
    }
    body.light-theme #nicknameSubmitBtn {
      background-color: #008844;
      color: #fff;
    }
    body.light-theme #nicknameSubmitBtn:hover {
      background-color: #006622;
    }
  </style>
</head>
<body>

<header>
  <h1>üéµ Free Music App v1.1.0</h1>
</header>

<div class="controls">
  <input id="search" type="text" placeholder="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–∞..." autocomplete="off" />
  <button onclick="filterByGenre('all')">–í—Å–µ</button>
  <button onclick="filterByGenre('classical')">–ö–ª–∞—Å—Å–∏–∫–∞</button>
  <button onclick="filterByGenre('lounge')">–õ–∞—É–Ω–∂</button>
  <button onclick="filterByGenre('electronic')">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
  <button onclick="filterByGenre('vintage')">–í–∏–Ω—Ç–∞–∂</button>
  <button onclick="filterByGenre('ethno')">–≠—Ç–Ω–æ</button>
  <button onclick="filterByGenre('live')">–õ–∞–π–≤</button>
  <button onclick="showFavorites()">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
  <button onclick="toggleTheme()">üåì –¢–µ–º–∞</button>
</div>

<div class="track-list" id="trackList"></div>

<div class="footer">¬© 2025 Free Music App ‚Äî –ú—É–∑—ã–∫–∞ –∏ —á–∞—Ç –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ</div>

<!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ -->
<button id="chatToggleBtn" title="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç">üí¨</button>

<!-- –ú–æ–¥–∞–ª–∫–∞ —á–∞—Ç–∞ -->
<div id="chatModal">
  <header>–ß–∞—Ç</header>
  <div id="chatMessages"></div>
  <div id="chatInputWrapper">
    <input id="chatInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off" />
    <button id="chatSendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –≤–≤–æ–¥–∞ –Ω–∏–∫–∞ -->
<div id="nicknameModal" style="display:none;">
  <div id="nicknameModalContent">
    <h2>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫ –¥–ª—è —á–∞—Ç–∞</h2>
    <input id="nicknameInput" type="text" placeholder="–í–∞—à –Ω–∏–∫" maxlength="20" />
    <button id="nicknameSubmitBtn">–í–æ–π—Ç–∏</button>
  </div>
</div>

<script>
  // –î–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–æ–≤ ‚Äî –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Å–≤–æ–∏–º–∏ mp3 –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
  const tracks = [
    {
      id: 1,
      title: "Classical Morning",
      src: "https://cdn.pixabay.com/download/audio/2021/12/26/audio_7e99b3be3f.mp3?filename=classical-morning-6969.mp3",
      genre: "classical",
    },
    {
      id: 2,
      title: "Lounge Vibes",
      src: "https://cdn.pixabay.com/download/audio/2022/03/15/audio_7a59db79a3.mp3?filename=lounge-vibes-1234.mp3",
      genre: "lounge",
    },
    {
      id: 3,
      title: "Electronic Beat",
      src: "https://cdn.pixabay.com/download/audio/2021/10/04/audio_63e3d4561c.mp3?filename=electronic-beat-5678.mp3",
      genre: "electronic",
    },
    {
      id: 4,
      title: "Vintage Jazz",
      src: "https://cdn.pixabay.com/download/audio/2021/09/25/audio_8f6b4b5767.mp3?filename=vintage-jazz-4321.mp3",
      genre: "vintage",
    },
    {
      id: 5,
      title: "Ethno Fusion",
      src: "https://cdn.pixabay.com/download/audio/2021/12/15/audio_7d6b3e0c1a.mp3?filename=ethno-fusion-7890.mp3",
      genre: "ethno",
    },
    {
      id: 6,
      title: "Live Concert",
      src: "https://cdn.pixabay.com/download/audio/2022/02/10/audio_4a1fbc6e2a.mp3?filename=live-concert-3456.mp3",
      genre: "live",
    },
  ];

  // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
  const favoritesKey = "fmapp_favorites";
  const chatHistoryKey = "fmapp_chat_history";
  const nicknameKey = "fmapp_nickname";
  const themeKey = "fmapp_theme";

  let favorites = JSON.parse(localStorage.getItem(favoritesKey)) || [];
  let currentGenre = "all";
  let currentSearch = "";
  let showingFavorites = false;

  const trackListEl = document.getElementById("trackList");
  const searchInput = document.getElementById("search");

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç—Ä–µ–∫–æ–≤
  function renderTracks() {
    trackListEl.innerHTML = "";

    let filteredTracks = tracks.filter(track => {
      if (showingFavorites && !favorites.includes(track.id)) return false;
      if (currentGenre !== "all" && track.genre !== currentGenre) return false;
      if (currentSearch.trim() !== "" && !track.title.toLowerCase().includes(currentSearch.toLowerCase())) return false;
      return true;
    });

    if (filteredTracks.length === 0) {
      trackListEl.innerHTML = `<p style="text-align:center; opacity:0.6; user-select:none;">–¢—Ä–µ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>`;
      return;
    }

    filteredTracks.forEach(track => {
      const isLiked = favorites.includes(track.id);
      const trackEl = document.createElement("div");
      trackEl.className = "track";

      trackEl.innerHTML = `
        <h3>${track.title}</h3>
        <audio controls preload="none" src="${track.src}"></audio>
        <span class="like${isLiked ? " liked" : ""}" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" data-id="${track.id}">&#10084;</span>
      `;

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∞–π–∫–∞
      trackEl.querySelector(".like").onclick = (e) => {
        const id = parseInt(e.target.dataset.id);
        toggleFavorite(id);
      };

      // –°–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –∑–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ –∞—É–¥–∏–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª –¥—Ä—É–≥–æ–µ
      const audio = trackEl.querySelector("audio");
      audio.onplay = () => {
        document.querySelectorAll("audio").forEach(a => {
          if (a !== audio) a.pause();
        });
      };

      trackListEl.appendChild(trackEl);
    });
  }

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã–º
  function toggleFavorite(id) {
    if (favorites.includes(id)) {
      favorites = favorites.filter(fav => fav !== id);
    } else {
      favorites.push(id);
    }
    localStorage.setItem(favoritesKey, JSON.stringify(favorites));
    renderTracks();
  }

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∂–∞–Ω—Ä—É
  function filterByGenre(genre) {
    currentGenre = genre;
    showingFavorites = false;
    renderTracks();
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
  function showFavorites() {
    showingFavorites = true;
    renderTracks();
  }

  // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
  searchInput.addEventListener("input", e => {
    currentSearch = e.target.value;
    showingFavorites = false;
    renderTracks();
  });

  // –¢–µ–º–∞
  function toggleTheme() {
    const body = document.body;
    if(body.classList.contains("light-theme")) {
      body.classList.remove("light-theme");
      localStorage.setItem(themeKey, "dark");
    } else {
      body.classList.add("light-theme");
      localStorage.setItem(themeKey, "light");
    }
  }
  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  function applyStoredTheme() {
    const theme = localStorage.getItem(themeKey);
    if(theme === "light") {
      document.body.classList.add("light-theme");
    } else {
      document.body.classList.remove("light-theme");
    }
  }

  // ==== –ß–∞—Ç –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ====

  const chatToggleBtn = document.getElementById("chatToggleBtn");
  const chatModal = document.getElementById("chatModal");
  const chatMessages = document.getElementById("chatMessages");
  const chatInput = document.getElementById("chatInput");
  const chatSendBtn = document.getElementById("chatSendBtn");

  const nicknameModal = document.getElementById("nicknameModal");
  const nicknameInput = document.getElementById("nicknameInput");
  const nicknameSubmitBtn = document.getElementById("nicknameSubmitBtn");

  let nickname = localStorage.getItem(nicknameKey) || null;
  let chatHistory = JSON.parse(localStorage.getItem(chatHistoryKey)) || [];

  function openChat() {
    if (!nickname) {
      nicknameModal.style.display = "flex";
    } else {
      chatModal.style.display = "flex";
      renderChatMessages();
      chatInput.focus();
    }
  }

  chatToggleBtn.addEventListener("click", () => {
    if (chatModal.style.display === "flex") {
      chatModal.style.display = "none";
    } else {
      openChat();
    }
  });

  nicknameSubmitBtn.addEventListener("click", () => {
    const name = nicknameInput.value.trim();
    if(name.length < 2) {
      alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –¥–ª–∏–Ω–æ–π –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞");
      return;
    }
    nickname = name;
    localStorage.setItem(nicknameKey, nickname);
    nicknameModal.style.display = "none";
    openChat();
  });

  nicknameInput.addEventListener("keydown", (e) => {
    if(e.key === "Enter") {
      nicknameSubmitBtn.click();
    }
  });

  function renderChatMessages() {
    chatMessages.innerHTML = "";
    chatHistory.forEach(msg => {
      const msgEl = document.createElement("div");
      msgEl.className = "chat-message " + (msg.nickname === nickname ? "me" : "other");
      msgEl.textContent = `${msg.nickname}: ${msg.text}`;
      chatMessages.appendChild(msgEl);
    });
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function sendMessage() {
    const text = chatInput.value.trim();
    if(text === "") return;
    const msg = {nickname, text, time: Date.now()};
    chatHistory.push(msg);
    if(chatHistory.length > 100) chatHistory.shift(); // –û–≥—Ä–∞–Ω–∏—á–∏–º –¥–æ 100 —Å–æ–æ–±—â–µ–Ω–∏–π
    localStorage.setItem(chatHistoryKey, JSON.stringify(chatHistory));
    chatInput.value = "";
    renderChatMessages();
  }

  chatSendBtn.addEventListener("click", sendMessage);
  chatInput.addEventListener("keydown", (e) => {
    if(e.key === "Enter") {
      sendMessage();
    }
  });

  // –ü—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–æ–¥–∞–ª–∫–∏ –Ω–∏–∫–∞ - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å (–º–æ–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å)
  nicknameModal.addEventListener("click", (e) => {
    if(e.target === nicknameModal) {
      // –ú–æ–∂–Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å, —á—Ç–æ–±—ã –Ω–∏–∫ –≤—Å–µ–≥–¥–∞ –±—ã–ª –≤–≤–µ–¥–µ–Ω
    }
  });

  // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
  applyStoredTheme();
  renderTracks();
</script>

</body>
</html>
