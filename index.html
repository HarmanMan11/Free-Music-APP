<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Free Music App</title>
  
  <!-- Roboto font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  
  <style>
    :root {
      --color-bg-dark: #121212;
      --color-bg-light: #f7f7f7;
      --color-text-dark: #e0e0e0;
      --color-text-light: #222;
      --color-primary: #00ff88;
      --color-secondary: #ff4081;
      --color-accent: #1f1f1f;
      --color-accent-light: #2e2e2e;
      --color-button-hover: #00cc6a;
      --transition: 0.3s ease;
    }

    /* –¢–µ–º—ã */
    body.dark-theme {
      background-color: var(--color-bg-dark);
      color: var(--color-text-dark);
    }
    body.light-theme {
      background-color: var(--color-bg-light);
      color: var(--color-text-light);
    }

    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      padding-bottom: 4rem;
      transition: background-color var(--transition), color var(--transition);
    }

    header {
      background-color: var(--color-accent);
      padding: 1.2rem 1rem;
      text-align: center;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
      user-select: none;
    }
    h1 {
      margin: 0;
      font-weight: 700;
      font-size: 1.8rem;
      color: var(--color-primary);
      text-shadow: 0 0 8px var(--color-primary);
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 0.75rem;
      padding: 1rem;
      background-color: var(--color-accent);
      user-select: none;
      align-items: center;
    }
    .controls input {
      grid-column: span 2;
      padding: 0.6rem 1rem;
      border-radius: 30px;
      border: none;
      outline: none;
      font-size: 1rem;
      transition: box-shadow var(--transition);
    }
    .controls input:focus {
      box-shadow: 0 0 8px var(--color-primary);
      background-color: #222;
      color: white;
    }
    .controls button {
      background-color: var(--color-primary);
      border: none;
      border-radius: 30px;
      padding: 0.5rem 1rem;
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--color-bg-dark);
      cursor: pointer;
      transition: background-color var(--transition), transform 0.15s ease;
      box-shadow: 0 3px 5px rgba(0, 255, 136, 0.4);
      user-select: none;
    }
    .controls button:hover:not(.active) {
      background-color: var(--color-button-hover);
      transform: scale(1.05);
      box-shadow: 0 4px 10px rgba(0, 255, 136, 0.7);
    }
    .controls button:active:not(.active) {
      transform: scale(0.95);
    }
    .controls button.active {
      background-color: var(--color-secondary);
      color: white;
      box-shadow: 0 0 15px var(--color-secondary);
      cursor: default;
      pointer-events: none;
    }

    #trackCount {
      grid-column: span 2;
      text-align: center;
      font-size: 0.9rem;
      color: var(--color-primary);
      font-weight: 500;
      user-select: none;
    }

    #loadingIndicator {
      text-align: center;
      font-style: italic;
      color: #999;
      margin-top: 0.5rem;
      user-select: none;
    }

    .track-list {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      max-width: 700px;
      margin: 0 auto 4rem;
    }
    .track {
      background: var(--color-accent-light);
      padding: 1rem 1.2rem;
      border-radius: 15px;
      width: 100%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      position: relative;
      transition: transform 0.25s ease;
    }
    .track:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 20px rgba(0, 255, 136, 0.7);
    }
    .track h3 {
      margin: 0 0 0.6rem;
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--color-primary);
      user-select: text;
    }
    audio {
      width: 100%;
      outline: none;
      border-radius: 10px;
      background-color: #000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
      cursor: pointer;
      user-select: none;
      margin-bottom: 0.5rem;
    }

    .like {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.8rem;
      cursor: pointer;
      user-select: none;
      color: #bbb;
      transition: color 0.3s ease, transform 0.2s ease;
      will-change: transform;
      filter: drop-shadow(0 0 1px rgba(0,0,0,0.6));
    }
    .like:hover {
      color: var(--color-secondary);
      transform: scale(1.2);
    }
    .like.liked {
      color: var(--color-secondary);
      animation: heartbeat 1s ease infinite;
    }
    .like.liked:hover {
      animation: none;
      transform: scale(1.3);
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.15); }
      50% { transform: scale(1.1); }
      75% { transform: scale(1.15); }
    }

    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--color-accent);
      padding: 1rem;
      text-align: center;
      color: #888;
      font-size: 0.9rem;
      user-select: none;
      box-shadow: 0 -3px 8px rgba(0, 0, 0, 0.3);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–µ–ª–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media (max-width: 480px) {
      .controls {
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
      }
      .controls input {
        grid-column: span 2;
      }
      .controls button {
        font-size: 0.85rem;
        padding: 0.5rem 0.7rem;
      }
    }
  </style>
</head>
<body class="dark-theme">

  <header>
    <h1>üéµ Free Music App</h1>
  </header>

  <div class="controls" role="region" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–æ–π">
    <input id="search" type="text" placeholder="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–∞..." aria-label="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–∞" />
    <button id="clearSearchBtn" title="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">–û—á–∏—Å—Ç–∏—Ç—å</button>
    <button data-genre="all" class="genre-btn active" aria-pressed="true">–í—Å–µ</button>
    <button data-genre="classical" class="genre-btn" aria-pressed="false">–ö–ª–∞—Å—Å–∏–∫–∞</button>
    <button data-genre="lounge" class="genre-btn" aria-pressed="false">–õ–∞—É–Ω–∂</button>
    <button data-genre="electronic" class="genre-btn" aria-pressed="false">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
    <button data-genre="vintage" class="genre-btn" aria-pressed="false">–í–∏–Ω—Ç–∞–∂</button>
    <button data-genre="ethno" class="genre-btn" aria-pressed="false">–≠—Ç–Ω–æ</button>
    <button data-genre="live" class="genre-btn" aria-pressed="false">–õ–∞–π–≤</button>
    <button id="showFavoritesBtn" title="–ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
    <button id="sortBtn" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é">‚¨ÜÔ∏è‚¨áÔ∏è –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</button>
    <button id="themeToggleBtn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåì –¢–µ–º–∞</button>
    <div id="trackCount" aria-live="polite" aria-atomic="true">–ù–∞–π–¥–µ–Ω–æ —Ç—Ä–µ–∫–æ–≤: 0</div>
  </div>

  <div id="loadingIndicator" aria-live="polite"></div>
  <main class="track-list" id="trackList" role="list"></main>

  <footer class="footer">
    Made with ‚ù§Ô∏è using archive.org open music
  </footer>

  <script>
    const musicTracks = [
      {
        title: "Sonatina in C major",
        src: "https://archive.org/download/MozartSonatinaInCMajor/MozartSonatinaInCMajor.mp3",
        genre: "classical"
      },
      {
        title: "Lounge Relaxation",
        src: "https://archive.org/download/LoungeRelaxation_201407/LoungeRelaxation.mp3",
        genre: "lounge"
      },
      {
        title: "Electronic Vibes",
        src: "https://archive.org/download/electronicvibes_201812/electronicvibes.mp3",
        genre: "electronic"
      },
      {
        title: "Vintage Jazz",
        src: "https://archive.org/download/vintagejazz_202001/vintagejazz.mp3",
        genre: "vintage"
      },
      {
        title: "Ethno Beats",
        src: "https://archive.org/download/ethnobeats_201904/ethnobeats.mp3",
        genre: "ethno"
      },
      {
        title: "Live Concert",
        src: "https://archive.org/download/liveconcert_202003/liveconcert.mp3",
        genre: "live"
      }
    ];

    let appState = {
      currentGenre: 'all',
      favorites: JSON.parse(localStorage.getItem('favorites') || '[]'),
      isShowingFavorites: false,
      sortedAsc: true
    };

    let filteredTracksCache = [];
    let currentPlayingIndex = -1;

    const trackListEl = document.getElementById('trackList');
    const trackCountEl = document.getElementById('trackCount');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const searchInput = document.getElementById('search');
    const clearSearchBtn = document.getElementById('clearSearchBtn');
    const genreButtons = [...document.querySelectorAll('.genre-btn')];
    const showFavoritesBtn = document.getElementById('showFavoritesBtn');
    const sortBtn = document.getElementById('sortBtn');
    const themeToggleBtn = document.getElementById('themeToggleBtn');

    // –†–µ–Ω–¥–µ—Ä —Ç—Ä–µ–∫–æ–≤
    function renderTracks(filter = '') {
      loadingIndicator.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤...';
      trackListEl.innerHTML = '';
      const lowerFilter = filter.toLowerCase();

      let tracksToRender = [];

      if (appState.isShowingFavorites) {
        tracksToRender = musicTracks.filter(t => appState.favorites.includes(t.src));
      } else {
        tracksToRender = musicTracks.filter(t => appState.currentGenre === 'all' || t.genre === appState.currentGenre);
      }

      if (filter) {
        tracksToRender = tracksToRender.filter(t => t.title.toLowerCase().includes(lowerFilter));
      }

      filteredTracksCache = tracksToRender;

      trackCountEl.textContent = `–ù–∞–π–¥–µ–Ω–æ —Ç—Ä–µ–∫–æ–≤: ${tracksToRender.length}`;

      if (tracksToRender.length === 0) {
        trackListEl.innerHTML = '<p style="text-align:center; color:#999; user-select:none;">–¢—Ä–µ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>';
        loadingIndicator.textContent = '';
        return;
      }

      tracksToRender.forEach((track, index) => {
        const div = document.createElement('div');
        div.className = 'track';
        div.setAttribute('role', 'listitem');
        div.tabIndex = 0;

        const liked = appState.favorites.includes(track.src);

        div.innerHTML = `
          <h3>${track.title}</h3>
          <audio controls src="${track.src}" preload="none" aria-label="–ê—É–¥–∏–æ —Ç—Ä–µ–∫: ${track.title}"></audio>
          <div class="like ${liked ? 'liked' : ''}" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" role="button" aria-pressed="${liked}">‚ù§Ô∏è</div>
        `;

        trackListEl.appendChild(div);

        const audio = div.querySelector('audio');
        const likeBtn = div.querySelector('.like');

        likeBtn.onclick = () => toggleLike(track.src, likeBtn);

        audio.onplay = () => {
          currentPlayingIndex = index;
          pauseOtherAudios(index);
        };

        audio.onended = () => {
          playNextTrack();
        };
      });

      loadingIndicator.textContent = '';
    }

    // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∞—É–¥–∏–æ –∫—Ä–æ–º–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ
    function pauseOtherAudios(exceptIndex) {
      const audios = document.querySelectorAll('#trackList audio');
      audios.forEach((audio, idx) => {
        if (idx !== exceptIndex) {
          audio.pause();
          audio.currentTime = 0;
        }
      });
    }

    // –ü—Ä–æ–∏–≥—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫
    function playNextTrack() {
      if (currentPlayingIndex < 0) return;
      const nextIndex = currentPlayingIndex + 1;
      if (nextIndex < filteredTracksCache.length) {
        const audios = document.querySelectorAll('#trackList audio');
        const nextAudio = audios[nextIndex];
        if (nextAudio) {
          nextAudio.play();
          currentPlayingIndex = nextIndex;
        }
      }
    }

    // –§–∏–ª—å—Ç—Ä –ø–æ –∂–∞–Ω—Ä—É —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º
    function filterByGenre(genre) {
      appState.currentGenre = genre;
      appState.isShowingFavorites = false;
      searchInput.value = '';

      genreButtons.forEach(btn => {
        if (btn.dataset.genre === genre) {
          btn.classList.add('active');
          btn.setAttribute('aria-pressed', 'true');
        } else {
          btn.classList.remove('active');
          btn.setAttribute('aria-pressed', 'false');
        }
      });

      showFavoritesBtn.classList.remove('active');
      showFavoritesBtn.setAttribute('aria-pressed', 'false');

      renderTracks();
    }

    function clearSearch() {
      searchInput.value = '';
      renderTracks();
    }

    function toggleLike(src, el) {
      if (appState.favorites.includes(src)) {
        appState.favorites = appState.favorites.filter(f => f !== src);
        el.classList.remove('liked');
        el.setAttribute('aria-pressed', 'false');
      } else {
        appState.favorites.push(src);
        el.classList.add('liked');
        el.setAttribute('aria-pressed', 'true');
      }
      localStorage.setItem('favorites', JSON.stringify(appState.favorites));
    }

    function showFavorites() {
      appState.isShowingFavorites = true;
      appState.currentGenre = 'all';

      genreButtons.forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-pressed', 'false');
      });
      showFavoritesBtn.classList.add('active');
      showFavoritesBtn.setAttribute('aria-pressed', 'true');

      searchInput.value = '';
      renderTracks();
    }

    function sortByTitle() {
      appState.sortedAsc = !appState.sortedAsc;
      musicTracks.sort((a, b) => {
        if (a.title.toLowerCase() < b.title.toLowerCase()) return appState.sortedAsc ? -1 : 1;
        if (a.title.toLowerCase() > b.title.toLowerCase()) return appState.sortedAsc ? 1 : -1;
        return 0;
      });
      renderTracks(searchInput.value);
    }

    function toggleTheme() {
      const body = document.body;
      if (body.classList.contains('dark-theme')) {
        body.classList.replace('dark-theme', 'light-theme');
        themeToggleBtn.textContent = 'üåô –¢–µ–º–∞';
      } else {
        body.classList.replace('light-theme', 'dark-theme');
        themeToggleBtn.textContent = 'üåì –¢–µ–º–∞';
      }
    }

    // –°–æ–±—ã—Ç–∏—è
    searchInput.addEventListener('input', () => renderTracks(searchInput.value));
    clearSearchBtn.addEventListener('click', clearSearch);
    genreButtons.forEach(btn => {
      btn.addEventListener('click', () => filterByGenre(btn.dataset.genre));
    });
    showFavoritesBtn.addEventListener('click', showFavorites);
    sortBtn.addEventListener('click', sortByTitle);
    themeToggleBtn.addEventListener('click', toggleTheme);

    // –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä
    window.onload = () => {
      renderTracks();
    };
  </script>
</body>
</html>
