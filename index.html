<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Free Music App —Å API, –ü–ª–µ–π–ª–∏—Å—Ç–æ–º –∏ PWA</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
<style>
  /* –°–±—Ä–æ—Å –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; font-family: 'Roboto', sans-serif;
    background-color: #121212; color: white;
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center;
    transition: background-color 0.4s ease, color 0.4s ease;
    padding-bottom: 6rem;
  }
  header {
    background-color: #1f1f1f;
    width: 100%; padding: 1rem 1.5rem;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.6);
    user-select: none;
  }
  h1 {
    margin: 0; color: #00ff88;
    font-weight: 700; font-size: 2rem; letter-spacing: 1px;
  }
  .controls {
    display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem;
    padding: 1rem 1.5rem;
    background-color: #1a1a1a;
    width: 100%; max-width: 960px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    border-radius: 12px;
    margin: 1rem 0;
    user-select: none;
  }
  .controls input {
    flex: 1 1 200px;
    padding: 0.6rem 1rem;
    border-radius: 8px;
    border: none;
    outline: none;
    font-size: 1rem;
    background-color: #282828;
    color: white;
    box-shadow: inset 0 0 5px #00ff88;
    transition: box-shadow 0.3s ease;
  }
  .controls input::placeholder {
    color: #aaa;
  }
  .controls input:focus {
    box-shadow: 0 0 10px #00ff88;
    background-color: #1e1e1e;
  }
  .controls button {
    background-color: #00ff88;
    border: none;
    border-radius: 8px;
    padding: 0.5rem 1.2rem;
    cursor: pointer;
    font-weight: 600;
    color: #121212;
    box-shadow: 0 4px 6px rgba(0,255,136,0.6);
    transition: background-color 0.3s ease, transform 0.15s ease;
    user-select: none;
    flex: 0 0 auto;
  }
  .controls button:hover {
    background-color: #00cc6a;
    transform: scale(1.05);
  }
  .controls button:active {
    transform: scale(0.95);
  }
  .track-list {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.2rem;
    padding: 0 1.5rem 6rem;
    width: 100%;
    max-width: 960px;
    flex-grow: 1;
  }
  .track {
    background: #2e2e2e;
    padding: 1rem 1.2rem;
    border-radius: 14px;
    max-width: 600px;
    width: 100%;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 0.7rem;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  .track:hover {
    background-color: #393939;
  }
  .track h3 {
    margin: 0;
    font-weight: 700;
    font-size: 1.2rem;
    color: #00ff88;
    user-select: text;
  }
  audio {
    width: 100%;
    outline: none;
    border-radius: 8px;
    box-shadow: inset 0 0 5px #00ff88;
    background-color: #121212;
  }
  .like {
    position: absolute;
    top: 1rem;
    right: 1rem;
    cursor: pointer;
    font-size: 1.8rem;
    user-select: none;
    transition: transform 0.3s ease, color 0.3s ease;
    color: #bbb;
    filter: drop-shadow(0 0 2px #000);
  }
  .like:hover {
    transform: scale(1.3);
    color: #ff4081;
    filter: drop-shadow(0 0 6px #ff4081);
  }
  .like.liked {
    color: #ff4081;
    animation: heartbeat 1s infinite;
    filter: drop-shadow(0 0 8px #ff4081);
  }
  @keyframes heartbeat {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.3); }
  }
  .footer {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: #1f1f1f;
    padding: 1rem;
    text-align: center;
    color: #888;
    user-select: none;
    font-size: 0.9rem;
    box-shadow: 0 -2px 6px rgba(0,0,0,0.7);
  }
  /* Light theme */
  body.light-theme {
    background-color: white;
    color: #121212;
  }
  body.light-theme header {
    background-color: #e0e0e0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  body.light-theme .controls {
    background-color: #f5f5f5;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  body.light-theme .controls input {
    background-color: #fff;
    color: #121212;
    box-shadow: inset 0 0 5px #00cc6a;
  }
  body.light-theme .controls input::placeholder {
    color: #666;
  }
  body.light-theme .track {
    background-color: #f0f0f0;
    color: #121212;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  body.light-theme .track:hover {
    background-color: #e6e6e6;
  }
  body.light-theme audio {
    background-color: #fff;
    box-shadow: inset 0 0 5px #00cc6a;
  }
  body.light-theme .like {
    color: #888;
    filter: none;
  }
  body.light-theme .like:hover {
    color: #e91e63;
    filter: drop-shadow(0 0 6px #e91e63);
  }
  body.light-theme .like.liked {
    color: #e91e63;
    filter: drop-shadow(0 0 8px #e91e63);
  }
  body.light-theme .footer {
    background: #e0e0e0;
    color: #444;
    box-shadow: 0 -2px 6px rgba(0,0,0,0.05);
  }
  /* –ü–ª–µ–π–ª–∏—Å—Ç */
  .playlist-controls {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin: 0 0 1rem 0;
  }
  .playlist-controls button {
    background-color: #00ff88;
    border: none;
    border-radius: 8px;
    padding: 0.6rem 1.4rem;
    cursor: pointer;
    font-weight: 700;
    color: #121212;
    box-shadow: 0 4px 6px rgba(0,255,136,0.8);
    transition: background-color 0.3s ease, transform 0.15s ease;
  }
  .playlist-controls button:hover {
    background-color: #00cc6a;
    transform: scale(1.1);
  }
  .playlist-controls button:active {
    transform: scale(0.95);
  }
  /* Responsive */
  @media (max-width: 640px) {
    .controls {
      flex-direction: column;
      gap: 0.7rem;
    }
    .controls input {
      flex: 1 1 100%;
    }
    .controls button {
      flex: 1 1 100%;
    }
    .track {
      max-width: 100%;
    }
    .track-list {
      padding: 0 1rem 6rem;
    }
  }
</style>
</head>
<body>

<header>
  <h1>üéµ Free Music App</h1>
</header>

<div class="controls">
  <input id="search" type="text" placeholder="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–∞..." autocomplete="off" aria-label="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–∞" />
  <button onclick="filterByGenre('all')" aria-pressed="true" id="btn-all">–í—Å–µ</button>
  <button onclick="filterByGenre('classical')" id="btn-classical">–ö–ª–∞—Å—Å–∏–∫–∞</button>
  <button onclick="filterByGenre('lounge')" id="btn-lounge">–õ–∞—É–Ω–∂</button>
  <button onclick="filterByGenre('electronic')" id="btn-electronic">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
  <button onclick="filterByGenre('vintage')" id="btn-vintage">–í–∏–Ω—Ç–∞–∂</button>
  <button onclick="filterByGenre('ethno')" id="btn-ethno">–≠—Ç–Ω–æ</button>
  <button onclick="filterByGenre('live')" id="btn-live">–õ–∞–π–≤</button>
  <button onclick="showFavorites()" id="btn-favorites">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
  <button onclick="toggleTheme()" id="btn-theme">üåì –¢–µ–º–∞</button>
</div>

<div class="playlist-controls" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–æ–º" style="display:none;">
  <button id="prevBtn" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫">‚èÆÔ∏è</button>
  <button id="playPauseBtn" aria-label="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏/–ü–∞—É–∑–∞">‚ñ∂Ô∏è</button>
  <button id="nextBtn" aria-label="–°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫">‚è≠Ô∏è</button>
</div>

<div class="track-list" id="trackList" role="list" aria-live="polite"></div>

<div class="footer">
  Made with ‚ù§Ô∏è using archive.org open music
</div>

<script>
  // –î–ª—è PWA - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è service worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js').catch(console.warn);
  }

  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  const appState = {
    currentGenre: 'all',
    favorites: JSON.parse(localStorage.getItem('favorites') || '[]'),
    isShowingFavorites: false,
    tracks: [], // —Å—é–¥–∞ –ø–æ–¥–≥—Ä—É–∑–∏–º —Å API
    filteredTracks: [],
    currentIndex: -1,
    isPlaying: false,
  };

  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–µ–∫–∏ –∏–∑ archive.org (–ø—É–±–ª–∏—á–Ω—ã–π json –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
  // –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ API —Ç—É—Ç –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å fetch –Ω–∞ Jamendo –∏ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å
  async function loadTracks() {
    // –ú–∞—Å—Å–∏–≤ –ø—Ä–∏–º–µ—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ —Å archive.org, –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å
    const exampleTracks = [
      { title: "Beethoven - Symphony No.5", src: "https://archive.org/download/BeethovenSymphony5/BeethovenSymphony5.mp3", genre: "classical" },
      { title: "Chopin - Prelude No.15", src: "https://archive.org/download/Chopin_Prelude_No_15/Chopin_Prelude_No_15.mp3", genre: "classical" },
      { title: "Electronic Breeze", src: "https://archive.org/download/electronic_beats/electronic_breeze.mp3", genre: "electronic" },
      { title: "Lounge Cafe", src: "https://archive.org/download/lounge_collection/lounge_cafe.mp3", genre: "lounge" },
      { title: "Vintage Jazz", src: "https://archive.org/download/vintage_jazz/vintage_jazz_01.mp3", genre: "vintage" },
      { title: "Ethno Vibes", src: "https://archive.org/download/ethno_collection/ethno_vibes.mp3", genre: "ethno" },
      { title: "Live Session A", src: "https://archive.org/download/live_music_a/live_session_a.mp3", genre: "live" },
    ];
    // —ç–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ - –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å fetch –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API
    appState.tracks = exampleTracks;
    renderTracks('');
  }

  // –ü–æ–∏—Å–∫ —Å debounce
  function debounce(func, delay) {
    let timeoutId;
    return function(...args) {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
  }

  const searchInput = document.getElementById('search');
  searchInput.addEventListener('input', debounce((e) => {
    appState.isShowingFavorites = false;
    appState.currentIndex = -1;
    renderTracks(e.target.value);
    hidePlaylistControls();
  }, 300));

  // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–∫–æ–≤
  function renderTracks(filter = '') {
    const list = document.getElementById('trackList');
    list.innerHTML = '';
    const f = filter.toLowerCase();

    // –§–∏–ª—å—Ç—Ä –ø–æ –∂–∞–Ω—Ä—É
    let filtered = appState.tracks.filter(track => {
      if (appState.currentGenre !== 'all' && track.genre !== appState.currentGenre) return false;
      if (appState.isShowingFavorites && !appState.favorites.includes(track.src)) return false;
      if (f && !track.title.toLowerCase().includes(f)) return false;
      return true;
    });

    appState.filteredTracks = filtered;

    if (filtered.length === 0) {
      list.innerHTML = `<p>–¢—Ä–µ–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>`;
      return;
    }

    filtered.forEach((track, i) => {
      const div = document.createElement('div');
      div.className = 'track';
      div.setAttribute('role', 'listitem');

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫
      const h3 = document.createElement('h3');
      h3.textContent = track.title;
      div.appendChild(h3);

      // –ê—É–¥–∏–æ
      const audio = document.createElement('audio');
      audio.src = track.src;
      audio.controls = true;
      audio.preload = "none";
      audio.id = `audio-${i}`;
      div.appendChild(audio);

      // –ö–Ω–æ–ø–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
      const like = document.createElement('span');
      like.className = 'like';
      like.innerHTML = appState.favorites.includes(track.src) ? '‚ù§Ô∏è' : 'ü§ç';
      if (appState.favorites.includes(track.src)) like.classList.add('liked');
      like.setAttribute('tabindex', '0');
      like.setAttribute('role', 'button');
      like.setAttribute('aria-pressed', appState.favorites.includes(track.src));
      like.setAttribute('aria-label', '–î–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');

      like.onclick = () => {
        toggleFavorite(track.src, like);
      };
      like.onkeypress = (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggleFavorite(track.src, like);
        }
      };

      div.appendChild(like);

      // –ü—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ ‚Äî —Å—Ç–∞–≤–∏–º —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å
      audio.onplay = () => {
        pauseOtherAudios(i);
        appState.currentIndex = i;
        appState.isPlaying = true;
        showPlaylistControls();
        updatePlayPauseButton(true);
      };
      audio.onpause = () => {
        appState.isPlaying = false;
        updatePlayPauseButton(false);
      };
      audio.onended = () => {
        playNextTrack();
      };

      list.appendChild(div);
    });
  }

  // –ü–∞—É–∑–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∞—É–¥–∏–æ –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ
  function pauseOtherAudios(currentIndex) {
    appState.filteredTracks.forEach((_, i) => {
      if (i !== currentIndex) {
        const audio = document.getElementById(`audio-${i}`);
        if (audio && !audio.paused) audio.pause();
      }
    });
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
  function toggleFavorite(src, element) {
    const idx = appState.favorites.indexOf(src);
    if (idx === -1) {
      appState.favorites.push(src);
      element.classList.add('liked');
      element.innerHTML = '‚ù§Ô∏è';
      element.setAttribute('aria-pressed', 'true');
    } else {
      appState.favorites.splice(idx, 1);
      element.classList.remove('liked');
      element.innerHTML = 'ü§ç';
      element.setAttribute('aria-pressed', 'false');
    }
    localStorage.setItem('favorites', JSON.stringify(appState.favorites));
  }

  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∂–∞–Ω—Ä—É
  function filterByGenre(genre) {
    appState.currentGenre = genre;
    appState.isShowingFavorites = false;
    appState.currentIndex = -1;
    searchInput.value = '';
    renderTracks('');
    hidePlaylistControls();
    updateGenreButtons(genre);
  }

  // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∂–∞–Ω—Ä–∞ (aria-pressed)
  function updateGenreButtons(activeGenre) {
    const buttons = document.querySelectorAll('.controls button');
    buttons.forEach(btn => {
      if (btn.id === 'btn-favorites' || btn.id === 'btn-theme') return;
      btn.setAttribute('aria-pressed', btn.id === `btn-${activeGenre}`);
    });
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
  function showFavorites() {
    appState.isShowingFavorites = true;
    appState.currentIndex = -1;
    searchInput.value = '';
    renderTracks('');
    hidePlaylistControls();
    // —Å–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –∂–∞–Ω—Ä–æ–≤
    updateGenreButtons('');
  }

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–æ–º
  const playPauseBtn = document.getElementById('playPauseBtn');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  playPauseBtn.onclick = () => {
    if (appState.currentIndex === -1) {
      playTrack(0);
    } else {
      togglePlayPause();
    }
  };
  prevBtn.onclick = () => {
    playPrevTrack();
  };
  nextBtn.onclick = () => {
    playNextTrack();
  };

  // –ü–ª–µ–π–ª–∏—Å—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å
  function showPlaylistControls() {
    document.querySelector('.playlist-controls').style.display = 'flex';
  }
  function hidePlaylistControls() {
    document.querySelector('.playlist-controls').style.display = 'none';
  }

  // –ü—Ä–æ–∏–≥—Ä–∞—Ç—å —Ç—Ä–µ–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É
  function playTrack(index) {
    if (index < 0 || index >= appState.filteredTracks.length) return;
    const audio = document.getElementById(`audio-${index}`);
    if (!audio) return;
    pauseOtherAudios(index);
    audio.play();
    appState.currentIndex = index;
    appState.isPlaying = true;
    showPlaylistControls();
    updatePlayPauseButton(true);
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å play/pause
  function togglePlayPause() {
    if (appState.currentIndex === -1) return;
    const audio = document.getElementById(`audio-${appState.currentIndex}`);
    if (!audio) return;
    if (audio.paused) {
      audio.play();
      appState.isPlaying = true;
      updatePlayPauseButton(true);
    } else {
      audio.pause();
      appState.isPlaying = false;
      updatePlayPauseButton(false);
    }
  }

  // –°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫
  function playNextTrack() {
    let nextIndex = appState.currentIndex + 1;
    if (nextIndex >= appState.filteredTracks.length) nextIndex = 0;
    playTrack(nextIndex);
  }
  // –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫
  function playPrevTrack() {
    let prevIndex = appState.currentIndex - 1;
    if (prevIndex < 0) prevIndex = appState.filteredTracks.length - 1;
    playTrack(prevIndex);
  }

  // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É play/pause –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ
  function updatePlayPauseButton(isPlaying) {
    playPauseBtn.textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
    playPauseBtn.setAttribute('aria-label', isPlaying ? '–ü–∞—É–∑–∞' : '–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏');
  }

  // –¢–µ–º–∞
  function toggleTheme() {
    if (document.body.classList.contains('light-theme')) {
      document.body.classList.remove('light-theme');
      localStorage.setItem('theme', 'dark');
      btnTheme.textContent = 'üåì –¢–µ–º–∞';
    } else {
      document.body.classList.add('light-theme');
      localStorage.setItem('theme', 'light');
      btnTheme.textContent = 'üåû –¢–µ–º–∞';
    }
  }
  const btnTheme = document.getElementById('btn-theme');
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–º—É –∏–∑ localStorage
  function loadTheme() {
    const theme = localStorage.getItem('theme');
    if (theme === 'light') {
      document.body.classList.add('light-theme');
      btnTheme.textContent = 'üåû –¢–µ–º–∞';
    } else {
      document.body.classList.remove('light-theme');
      btnTheme.textContent = 'üåì –¢–µ–º–∞';
    }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  loadTheme();
  loadTracks();

</script>

</body>
</html>
